\hypertarget{spglue__max__meat_8hpp_source}{}\doxysection{spglue\+\_\+max\+\_\+meat.\+hpp}
\label{spglue__max__meat_8hpp_source}\index{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/spglue\_max\_meat.hpp@{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/spglue\_max\_meat.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright 2008-\/2016 Conrad Sanderson (http://conradsanderson.id.au)}}
\DoxyCodeLine{2 \textcolor{comment}{// Copyright 2008-\/2016 National ICT Australia (NICTA)}}
\DoxyCodeLine{3 \textcolor{comment}{// }}
\DoxyCodeLine{4 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{// http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{8 \textcolor{comment}{// }}
\DoxyCodeLine{9 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{10 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{11 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{12 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{13 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{19 }
\DoxyCodeLine{20 }
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{23 \textcolor{keyword}{inline}}
\DoxyCodeLine{24 \textcolor{keywordtype}{void}}
\DoxyCodeLine{25 spglue\_max::apply(\mbox{\hyperlink{classSpMat}{SpMat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classSpGlue}{SpGlue<T1,T2,spglue\_max>}}\& X)}
\DoxyCodeLine{26   \{}
\DoxyCodeLine{27   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{28   }
\DoxyCodeLine{29   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{30   }
\DoxyCodeLine{31   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}} pa(X.A);}
\DoxyCodeLine{32   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}} pb(X.B);}
\DoxyCodeLine{33   }
\DoxyCodeLine{34   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} is\_alias = pa.is\_alias(out) || pb.is\_alias(out);}
\DoxyCodeLine{35   }
\DoxyCodeLine{36   \textcolor{keywordflow}{if}(is\_alias == \textcolor{keyword}{false})}
\DoxyCodeLine{37     \{}
\DoxyCodeLine{38     spglue\_max::apply\_noalias(out, pa, pb);}
\DoxyCodeLine{39     \}}
\DoxyCodeLine{40   \textcolor{keywordflow}{else}}
\DoxyCodeLine{41     \{}
\DoxyCodeLine{42     \mbox{\hyperlink{classSpMat}{SpMat<eT>}} tmp;}
\DoxyCodeLine{43     }
\DoxyCodeLine{44     spglue\_max::apply\_noalias(tmp, pa, pb);}
\DoxyCodeLine{45     }
\DoxyCodeLine{46     out.\mbox{\hyperlink{group__SpMat_ga17a2f694c4d85832d3744cdb08385213}{steal\_mem}}(tmp);}
\DoxyCodeLine{47     \}}
\DoxyCodeLine{48   \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 }
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT, \textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{53 \textcolor{keyword}{inline}}
\DoxyCodeLine{54 \textcolor{keywordtype}{void}}
\DoxyCodeLine{55 spglue\_max::apply\_noalias(\mbox{\hyperlink{classSpMat}{SpMat<eT>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}}\& pa, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}}\& pb)}
\DoxyCodeLine{56   \{}
\DoxyCodeLine{57   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{58   }
\DoxyCodeLine{59   arma\_debug\_assert\_same\_size(pa.get\_n\_rows(), pa.get\_n\_cols(), pb.get\_n\_rows(), pb.get\_n\_cols(), \textcolor{stringliteral}{"{}element-\/wise max"{}});}
\DoxyCodeLine{60   }
\DoxyCodeLine{61   \textcolor{keyword}{const} uword max\_n\_nonzero = pa.get\_n\_nonzero() + pb.get\_n\_nonzero();}
\DoxyCodeLine{62   }
\DoxyCodeLine{63   \textcolor{comment}{// Resize memory to upper bound}}
\DoxyCodeLine{64   out.\mbox{\hyperlink{group__SpMat_gac9162550cc7b009108f58ebf931be224}{reserve}}(pa.get\_n\_rows(), pa.get\_n\_cols(), max\_n\_nonzero);}
\DoxyCodeLine{65   }
\DoxyCodeLine{66   \textcolor{comment}{// Now iterate across both matrices.}}
\DoxyCodeLine{67   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_it  = pa.begin();}
\DoxyCodeLine{68   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_end = pa.end();}
\DoxyCodeLine{69   }
\DoxyCodeLine{70   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_it  = pb.begin();}
\DoxyCodeLine{71   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_end = pb.end();}
\DoxyCodeLine{72   }
\DoxyCodeLine{73   uword count = 0;}
\DoxyCodeLine{74   }
\DoxyCodeLine{75   \textcolor{keywordflow}{while}( (x\_it != x\_end) || (y\_it != y\_end) )}
\DoxyCodeLine{76     \{}
\DoxyCodeLine{77     eT out\_val;}
\DoxyCodeLine{78     }
\DoxyCodeLine{79     \textcolor{keyword}{const} uword x\_it\_col = x\_it.col();}
\DoxyCodeLine{80     \textcolor{keyword}{const} uword x\_it\_row = x\_it.row();}
\DoxyCodeLine{81     }
\DoxyCodeLine{82     \textcolor{keyword}{const} uword y\_it\_col = y\_it.col();}
\DoxyCodeLine{83     \textcolor{keyword}{const} uword y\_it\_row = y\_it.row();}
\DoxyCodeLine{84     }
\DoxyCodeLine{85     \textcolor{keywordtype}{bool} use\_y\_loc = \textcolor{keyword}{false};}
\DoxyCodeLine{86     }
\DoxyCodeLine{87     \textcolor{keywordflow}{if}(x\_it == y\_it)}
\DoxyCodeLine{88       \{}
\DoxyCodeLine{89       out\_val = \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{elem\_max}}(eT(*x\_it), eT(*y\_it));}
\DoxyCodeLine{90       }
\DoxyCodeLine{91       ++x\_it;}
\DoxyCodeLine{92       ++y\_it;}
\DoxyCodeLine{93       \}}
\DoxyCodeLine{94     \textcolor{keywordflow}{else}}
\DoxyCodeLine{95       \{}
\DoxyCodeLine{96       \textcolor{keywordflow}{if}((x\_it\_col < y\_it\_col) || ((x\_it\_col == y\_it\_col) \&\& (x\_it\_row < y\_it\_row))) \textcolor{comment}{// if y is closer to the end}}
\DoxyCodeLine{97         \{}
\DoxyCodeLine{98         out\_val = \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{elem\_max}}(eT(*x\_it), eT(0));}
\DoxyCodeLine{99         }
\DoxyCodeLine{100         ++x\_it;}
\DoxyCodeLine{101         \}}
\DoxyCodeLine{102       \textcolor{keywordflow}{else}}
\DoxyCodeLine{103         \{}
\DoxyCodeLine{104         out\_val = \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{elem\_max}}(eT(*y\_it), eT(0));}
\DoxyCodeLine{105         }
\DoxyCodeLine{106         ++y\_it;}
\DoxyCodeLine{107         }
\DoxyCodeLine{108         use\_y\_loc = \textcolor{keyword}{true};}
\DoxyCodeLine{109         \}}
\DoxyCodeLine{110       \}}
\DoxyCodeLine{111     }
\DoxyCodeLine{112     \textcolor{keywordflow}{if}(out\_val != eT(0))}
\DoxyCodeLine{113       \{}
\DoxyCodeLine{114       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.values[count]) = out\_val;}
\DoxyCodeLine{115       }
\DoxyCodeLine{116       \textcolor{keyword}{const} uword out\_row = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_row : y\_it\_row;}
\DoxyCodeLine{117       \textcolor{keyword}{const} uword out\_col = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_col : y\_it\_col;}
\DoxyCodeLine{118       }
\DoxyCodeLine{119       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.row\_indices[count]) = out\_row;}
\DoxyCodeLine{120       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.col\_ptrs[out\_col + 1])++;}
\DoxyCodeLine{121       ++count;}
\DoxyCodeLine{122       \}}
\DoxyCodeLine{123     }
\DoxyCodeLine{124     \mbox{\hyperlink{group__debug_ga458beb676810b1e43df9f0668359e76f}{arma\_check}}( (count > max\_n\_nonzero), \textcolor{stringliteral}{"{}internal error: spglue\_max::apply\_noalias(): count > max\_n\_nonzero"{}} );}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126   }
\DoxyCodeLine{127   \textcolor{keyword}{const} uword out\_n\_cols = out.\mbox{\hyperlink{classSpMat_a4f01c9d35f90eb836c6be489605052dd}{n\_cols}};}
\DoxyCodeLine{128   }
\DoxyCodeLine{129   uword* col\_ptrs = access::rwp(out.col\_ptrs);}
\DoxyCodeLine{130   }
\DoxyCodeLine{131   \textcolor{comment}{// Fix column pointers to be cumulative.}}
\DoxyCodeLine{132   \textcolor{keywordflow}{for}(uword c = 1; c <= out\_n\_cols; ++c)}
\DoxyCodeLine{133     \{}
\DoxyCodeLine{134     col\_ptrs[c] += col\_ptrs[c -\/ 1];}
\DoxyCodeLine{135     \}}
\DoxyCodeLine{136   }
\DoxyCodeLine{137   \textcolor{keywordflow}{if}(count < max\_n\_nonzero)}
\DoxyCodeLine{138     \{}
\DoxyCodeLine{139     \textcolor{keywordflow}{if}(count <= (max\_n\_nonzero/2))}
\DoxyCodeLine{140       \{}
\DoxyCodeLine{141       out.mem\_resize(count);}
\DoxyCodeLine{142       \}}
\DoxyCodeLine{143     \textcolor{keywordflow}{else}}
\DoxyCodeLine{144       \{}
\DoxyCodeLine{145       \textcolor{comment}{// quick resize without reallocating memory and copying data}}
\DoxyCodeLine{146       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(         out.\mbox{\hyperlink{classSpMat_a71a87b0de327d5643983dd21f455b984}{n\_nonzero}}) = count;}
\DoxyCodeLine{147       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(     out.values[count]) = eT(0);}
\DoxyCodeLine{148       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.row\_indices[count]) = uword(0);}
\DoxyCodeLine{149       \}}
\DoxyCodeLine{150     \}}
\DoxyCodeLine{151   \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 }
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT>}
\DoxyCodeLine{156 \textcolor{keyword}{inline}}
\DoxyCodeLine{157 \textcolor{keywordtype}{void}}
\DoxyCodeLine{158 spglue\_max::apply\_noalias(\mbox{\hyperlink{classSpMat}{SpMat<eT>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classSpMat}{SpMat<eT>}}\& \mbox{\hyperlink{structA}{A}}, \textcolor{keyword}{const} \mbox{\hyperlink{classSpMat}{SpMat<eT>}}\& \mbox{\hyperlink{structB}{B}})}
\DoxyCodeLine{159   \{}
\DoxyCodeLine{160   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{161   }
\DoxyCodeLine{162   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy< SpMat<eT>}} > pa(\mbox{\hyperlink{structA}{A}});}
\DoxyCodeLine{163   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy< SpMat<eT>}} > pb(\mbox{\hyperlink{structB}{B}});}
\DoxyCodeLine{164   }
\DoxyCodeLine{165   spglue\_max::apply\_noalias(out, pa, pb);}
\DoxyCodeLine{166   \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 }
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT, \textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{171 \textcolor{keyword}{inline}}
\DoxyCodeLine{172 \textcolor{keywordtype}{void}}
\DoxyCodeLine{173 spglue\_max::dense\_sparse\_max(\mbox{\hyperlink{classMat}{Mat<eT>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<eT,T1>}}\& X, \textcolor{keyword}{const} \mbox{\hyperlink{structSpBase}{SpBase<eT,T2>}}\& Y)}
\DoxyCodeLine{174   \{}
\DoxyCodeLine{175   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{176   }
\DoxyCodeLine{177   \textcolor{comment}{// NOTE: this function assumes there is no aliasing between matrix 'out' and X}}
\DoxyCodeLine{178   }
\DoxyCodeLine{179   \textcolor{keyword}{const}   \mbox{\hyperlink{classProxy}{Proxy<T1>}} pa(X.get\_ref());}
\DoxyCodeLine{180   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}} pb(Y.get\_ref());}
\DoxyCodeLine{181   }
\DoxyCodeLine{182   \textcolor{keyword}{const} uword n\_rows = pa.get\_n\_rows();}
\DoxyCodeLine{183   \textcolor{keyword}{const} uword n\_cols = pa.get\_n\_cols();}
\DoxyCodeLine{184   }
\DoxyCodeLine{185   arma\_debug\_assert\_same\_size( n\_rows, n\_cols, pb.get\_n\_rows(), pb.get\_n\_cols(), \textcolor{stringliteral}{"{}element-\/wise maximum"{}} );}
\DoxyCodeLine{186   }
\DoxyCodeLine{187   out.\mbox{\hyperlink{group__Mat_ga750c2d7d0bd0cf7b88e17a24db252438}{set\_size}}(n\_rows, n\_cols);}
\DoxyCodeLine{188   }
\DoxyCodeLine{189   \textcolor{keywordflow}{for}(uword c=0; c < n\_cols; ++c)}
\DoxyCodeLine{190   \textcolor{keywordflow}{for}(uword r=0; r < n\_rows; ++r)}
\DoxyCodeLine{191     \{}
\DoxyCodeLine{192     out.\mbox{\hyperlink{group__Mat_ga62c874c45807d7853afd231ae9f512d7}{at}}(r,c) = \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{elem\_max}}(pa.at(r,c), pb.at(r,c));}
\DoxyCodeLine{193     \}}
\DoxyCodeLine{194   \}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 }
\DoxyCodeLine{197 }
\DoxyCodeLine{199 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT>}
\DoxyCodeLine{200 \textcolor{keyword}{inline}}
\DoxyCodeLine{201 \textcolor{keyword}{typename} \mbox{\hyperlink{structenable__if2}{enable\_if2<is\_cx<eT>::no}}, eT>::result}
\DoxyCodeLine{202 \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{spglue\_max::elem\_max}}(\textcolor{keyword}{const} eT\& a, \textcolor{keyword}{const} eT\& b)}
\DoxyCodeLine{203   \{}
\DoxyCodeLine{204   \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__fn__max_gaf2317ac99c92ae7a239291d01a615893}{std::max}})(a, b);}
\DoxyCodeLine{205   \}}
\DoxyCodeLine{206 }
\DoxyCodeLine{207 }
\DoxyCodeLine{208 }
\DoxyCodeLine{210 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT>}
\DoxyCodeLine{211 \textcolor{keyword}{inline}}
\DoxyCodeLine{212 \textcolor{keyword}{typename} \mbox{\hyperlink{structenable__if2}{enable\_if2<is\_cx<eT>::yes}}, eT>::result}
\DoxyCodeLine{213 \mbox{\hyperlink{group__spglue__max_ga2b3ba81ef0c107fdff1992c224d45e03}{spglue\_max::elem\_max}}(\textcolor{keyword}{const} eT\& a, \textcolor{keyword}{const} eT\& b)}
\DoxyCodeLine{214   \{}
\DoxyCodeLine{215   \textcolor{keywordflow}{return} (std::abs(a) > std::abs(b)) ? a : b;}
\DoxyCodeLine{216   \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{218 }
\DoxyCodeLine{219 }

\end{DoxyCode}
