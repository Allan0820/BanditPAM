\hypertarget{spglue__relational__meat_8hpp_source}{}\doxysection{spglue\+\_\+relational\+\_\+meat.\+hpp}
\label{spglue__relational__meat_8hpp_source}\index{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/spglue\_relational\_meat.hpp@{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/spglue\_relational\_meat.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright 2008-\/2016 Conrad Sanderson (http://conradsanderson.id.au)}}
\DoxyCodeLine{2 \textcolor{comment}{// Copyright 2008-\/2016 National ICT Australia (NICTA)}}
\DoxyCodeLine{3 \textcolor{comment}{// }}
\DoxyCodeLine{4 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{// http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{8 \textcolor{comment}{// }}
\DoxyCodeLine{9 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{10 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{11 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{12 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{13 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{19 }
\DoxyCodeLine{20 }
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{23 \textcolor{keyword}{inline}}
\DoxyCodeLine{24 \textcolor{keywordtype}{void}}
\DoxyCodeLine{25 spglue\_rel\_lt::apply(\mbox{\hyperlink{classSpMat}{SpMat<uword>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classmtSpGlue}{mtSpGlue<uword, T1, T2, spglue\_rel\_lt>}}\& X)}
\DoxyCodeLine{26   \{}
\DoxyCodeLine{27   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{28   }
\DoxyCodeLine{29   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}} PA(X.A);}
\DoxyCodeLine{30   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}} PB(X.B);}
\DoxyCodeLine{31   }
\DoxyCodeLine{32   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} is\_alias = PA.is\_alias(out) || PB.is\_alias(out);}
\DoxyCodeLine{33   }
\DoxyCodeLine{34   \textcolor{keywordflow}{if}(is\_alias == \textcolor{keyword}{false})}
\DoxyCodeLine{35     \{}
\DoxyCodeLine{36     spglue\_rel\_lt::apply\_noalias(out, PA, PB);}
\DoxyCodeLine{37     \}}
\DoxyCodeLine{38   \textcolor{keywordflow}{else}}
\DoxyCodeLine{39     \{}
\DoxyCodeLine{40     \mbox{\hyperlink{classSpMat}{SpMat<uword>}} tmp;}
\DoxyCodeLine{41     }
\DoxyCodeLine{42     spglue\_rel\_lt::apply\_noalias(tmp, PA, PB);}
\DoxyCodeLine{43     }
\DoxyCodeLine{44     out.\mbox{\hyperlink{group__SpMat_ga17a2f694c4d85832d3744cdb08385213}{steal\_mem}}(tmp);}
\DoxyCodeLine{45     \}}
\DoxyCodeLine{46   \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 }
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{51 \textcolor{keyword}{inline}}
\DoxyCodeLine{52 \textcolor{keywordtype}{void}}
\DoxyCodeLine{53 spglue\_rel\_lt::apply\_noalias(\mbox{\hyperlink{classSpMat}{SpMat<uword>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}}\& PA, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}}\& PB)}
\DoxyCodeLine{54   \{}
\DoxyCodeLine{55   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{56   }
\DoxyCodeLine{57   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{58   }
\DoxyCodeLine{59   arma\_debug\_assert\_same\_size(PA.get\_n\_rows(), PA.get\_n\_cols(), PB.get\_n\_rows(), PB.get\_n\_cols(), \textcolor{stringliteral}{"{}operator<"{}});}
\DoxyCodeLine{60   }
\DoxyCodeLine{61   \textcolor{keyword}{const} uword max\_n\_nonzero = PA.get\_n\_nonzero() + PB.get\_n\_nonzero();}
\DoxyCodeLine{62   }
\DoxyCodeLine{63   \textcolor{comment}{// Resize memory to upper bound}}
\DoxyCodeLine{64   out.\mbox{\hyperlink{group__SpMat_gac9162550cc7b009108f58ebf931be224}{reserve}}(PA.get\_n\_rows(), PA.get\_n\_cols(), max\_n\_nonzero);}
\DoxyCodeLine{65   }
\DoxyCodeLine{66   \textcolor{comment}{// Now iterate across both matrices.}}
\DoxyCodeLine{67   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_it  = PA.begin();}
\DoxyCodeLine{68   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_end = PA.end();}
\DoxyCodeLine{69   }
\DoxyCodeLine{70   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_it  = PB.begin();}
\DoxyCodeLine{71   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_end = PB.end();}
\DoxyCodeLine{72   }
\DoxyCodeLine{73   uword count = 0;}
\DoxyCodeLine{74   }
\DoxyCodeLine{75   \textcolor{keywordflow}{while}( (x\_it != x\_end) || (y\_it != y\_end) )}
\DoxyCodeLine{76     \{}
\DoxyCodeLine{77     uword out\_val;}
\DoxyCodeLine{78     }
\DoxyCodeLine{79     \textcolor{keyword}{const} uword x\_it\_col = x\_it.col();}
\DoxyCodeLine{80     \textcolor{keyword}{const} uword x\_it\_row = x\_it.row();}
\DoxyCodeLine{81     }
\DoxyCodeLine{82     \textcolor{keyword}{const} uword y\_it\_col = y\_it.col();}
\DoxyCodeLine{83     \textcolor{keyword}{const} uword y\_it\_row = y\_it.row();}
\DoxyCodeLine{84     }
\DoxyCodeLine{85     \textcolor{keywordtype}{bool} use\_y\_loc = \textcolor{keyword}{false};}
\DoxyCodeLine{86     }
\DoxyCodeLine{87     \textcolor{keywordflow}{if}(x\_it == y\_it)}
\DoxyCodeLine{88       \{}
\DoxyCodeLine{89       out\_val = ((*x\_it) < (*y\_it)) ? uword(1) : uword(0);}
\DoxyCodeLine{90       }
\DoxyCodeLine{91       ++x\_it;}
\DoxyCodeLine{92       ++y\_it;}
\DoxyCodeLine{93       \}}
\DoxyCodeLine{94     \textcolor{keywordflow}{else}}
\DoxyCodeLine{95       \{}
\DoxyCodeLine{96       \textcolor{keywordflow}{if}((x\_it\_col < y\_it\_col) || ((x\_it\_col == y\_it\_col) \&\& (x\_it\_row < y\_it\_row))) \textcolor{comment}{// if y is closer to the end}}
\DoxyCodeLine{97         \{}
\DoxyCodeLine{98         out\_val = ((*x\_it) < eT(0)) ? uword(1) : uword(0);}
\DoxyCodeLine{99         }
\DoxyCodeLine{100         ++x\_it;}
\DoxyCodeLine{101         \}}
\DoxyCodeLine{102       \textcolor{keywordflow}{else}}
\DoxyCodeLine{103         \{}
\DoxyCodeLine{104         out\_val = (eT(0) < (*y\_it)) ? uword(1) : uword(0);}
\DoxyCodeLine{105         }
\DoxyCodeLine{106         ++y\_it;}
\DoxyCodeLine{107         }
\DoxyCodeLine{108         use\_y\_loc = \textcolor{keyword}{true};}
\DoxyCodeLine{109         \}}
\DoxyCodeLine{110       \}}
\DoxyCodeLine{111     }
\DoxyCodeLine{112     \textcolor{keywordflow}{if}(out\_val != uword(0))}
\DoxyCodeLine{113       \{}
\DoxyCodeLine{114       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.values[count]) = out\_val;}
\DoxyCodeLine{115       }
\DoxyCodeLine{116       \textcolor{keyword}{const} uword out\_row = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_row : y\_it\_row;}
\DoxyCodeLine{117       \textcolor{keyword}{const} uword out\_col = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_col : y\_it\_col;}
\DoxyCodeLine{118       }
\DoxyCodeLine{119       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.row\_indices[count]) = out\_row;}
\DoxyCodeLine{120       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.col\_ptrs[out\_col + 1])++;}
\DoxyCodeLine{121       ++count;}
\DoxyCodeLine{122       \}}
\DoxyCodeLine{123     }
\DoxyCodeLine{124     \mbox{\hyperlink{group__debug_ga458beb676810b1e43df9f0668359e76f}{arma\_check}}( (count > max\_n\_nonzero), \textcolor{stringliteral}{"{}internal error: spglue\_rel\_lt::apply\_noalias(): count > max\_n\_nonzero"{}} );}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126   }
\DoxyCodeLine{127   \textcolor{keyword}{const} uword out\_n\_cols = out.\mbox{\hyperlink{classSpMat_a4f01c9d35f90eb836c6be489605052dd}{n\_cols}};}
\DoxyCodeLine{128   }
\DoxyCodeLine{129   uword* col\_ptrs = access::rwp(out.col\_ptrs);}
\DoxyCodeLine{130   }
\DoxyCodeLine{131   \textcolor{comment}{// Fix column pointers to be cumulative.}}
\DoxyCodeLine{132   \textcolor{keywordflow}{for}(uword c = 1; c <= out\_n\_cols; ++c)}
\DoxyCodeLine{133     \{}
\DoxyCodeLine{134     col\_ptrs[c] += col\_ptrs[c -\/ 1];}
\DoxyCodeLine{135     \}}
\DoxyCodeLine{136   }
\DoxyCodeLine{137   \textcolor{keywordflow}{if}(count < max\_n\_nonzero)}
\DoxyCodeLine{138     \{}
\DoxyCodeLine{139     \textcolor{keywordflow}{if}(count <= (max\_n\_nonzero/2))}
\DoxyCodeLine{140       \{}
\DoxyCodeLine{141       out.mem\_resize(count);}
\DoxyCodeLine{142       \}}
\DoxyCodeLine{143     \textcolor{keywordflow}{else}}
\DoxyCodeLine{144       \{}
\DoxyCodeLine{145       \textcolor{comment}{// quick resize without reallocating memory and copying data}}
\DoxyCodeLine{146       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(         out.\mbox{\hyperlink{classSpMat_a71a87b0de327d5643983dd21f455b984}{n\_nonzero}}) = count;}
\DoxyCodeLine{147       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(     out.values[count]) = eT(0);}
\DoxyCodeLine{148       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.row\_indices[count]) = uword(0);}
\DoxyCodeLine{149       \}}
\DoxyCodeLine{150     \}}
\DoxyCodeLine{151   \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 }
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{comment}{//}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157 }
\DoxyCodeLine{158 }
\DoxyCodeLine{159 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{160 \textcolor{keyword}{inline}}
\DoxyCodeLine{161 \textcolor{keywordtype}{void}}
\DoxyCodeLine{162 spglue\_rel\_gt::apply(\mbox{\hyperlink{classSpMat}{SpMat<uword>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classmtSpGlue}{mtSpGlue<uword, T1, T2, spglue\_rel\_gt>}}\& X)}
\DoxyCodeLine{163   \{}
\DoxyCodeLine{164   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{165   }
\DoxyCodeLine{166   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}} PA(X.A);}
\DoxyCodeLine{167   \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}} PB(X.B);}
\DoxyCodeLine{168   }
\DoxyCodeLine{169   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} is\_alias = PA.is\_alias(out) || PB.is\_alias(out);}
\DoxyCodeLine{170   }
\DoxyCodeLine{171   \textcolor{keywordflow}{if}(is\_alias == \textcolor{keyword}{false})}
\DoxyCodeLine{172     \{}
\DoxyCodeLine{173     spglue\_rel\_gt::apply\_noalias(out, PA, PB);}
\DoxyCodeLine{174     \}}
\DoxyCodeLine{175   \textcolor{keywordflow}{else}}
\DoxyCodeLine{176     \{}
\DoxyCodeLine{177     \mbox{\hyperlink{classSpMat}{SpMat<uword>}} tmp;}
\DoxyCodeLine{178     }
\DoxyCodeLine{179     spglue\_rel\_gt::apply\_noalias(tmp, PA, PB);}
\DoxyCodeLine{180     }
\DoxyCodeLine{181     out.\mbox{\hyperlink{group__SpMat_ga17a2f694c4d85832d3744cdb08385213}{steal\_mem}}(tmp);}
\DoxyCodeLine{182     \}}
\DoxyCodeLine{183   \}}
\DoxyCodeLine{184 }
\DoxyCodeLine{185 }
\DoxyCodeLine{186 }
\DoxyCodeLine{187 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{188 \textcolor{keyword}{inline}}
\DoxyCodeLine{189 \textcolor{keywordtype}{void}}
\DoxyCodeLine{190 spglue\_rel\_gt::apply\_noalias(\mbox{\hyperlink{classSpMat}{SpMat<uword>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>}}\& PA, \textcolor{keyword}{const} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>}}\& PB)}
\DoxyCodeLine{191   \{}
\DoxyCodeLine{192   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{193   }
\DoxyCodeLine{194   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{195   }
\DoxyCodeLine{196   arma\_debug\_assert\_same\_size(PA.get\_n\_rows(), PA.get\_n\_cols(), PB.get\_n\_rows(), PB.get\_n\_cols(), \textcolor{stringliteral}{"{}operator>"{}});}
\DoxyCodeLine{197   }
\DoxyCodeLine{198   \textcolor{keyword}{const} uword max\_n\_nonzero = PA.get\_n\_nonzero() + PB.get\_n\_nonzero();}
\DoxyCodeLine{199   }
\DoxyCodeLine{200   \textcolor{comment}{// Resize memory to upper bound}}
\DoxyCodeLine{201   out.\mbox{\hyperlink{group__SpMat_gac9162550cc7b009108f58ebf931be224}{reserve}}(PA.get\_n\_rows(), PA.get\_n\_cols(), max\_n\_nonzero);}
\DoxyCodeLine{202   }
\DoxyCodeLine{203   \textcolor{comment}{// Now iterate across both matrices.}}
\DoxyCodeLine{204   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_it  = PA.begin();}
\DoxyCodeLine{205   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T1>::const\_iterator\_type}} x\_end = PA.end();}
\DoxyCodeLine{206   }
\DoxyCodeLine{207   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_it  = PB.begin();}
\DoxyCodeLine{208   \textcolor{keyword}{typename} \mbox{\hyperlink{classSpProxy}{SpProxy<T2>::const\_iterator\_type}} y\_end = PB.end();}
\DoxyCodeLine{209   }
\DoxyCodeLine{210   uword count = 0;}
\DoxyCodeLine{211   }
\DoxyCodeLine{212   \textcolor{keywordflow}{while}( (x\_it != x\_end) || (y\_it != y\_end) )}
\DoxyCodeLine{213     \{}
\DoxyCodeLine{214     uword out\_val;}
\DoxyCodeLine{215     }
\DoxyCodeLine{216     \textcolor{keyword}{const} uword x\_it\_col = x\_it.col();}
\DoxyCodeLine{217     \textcolor{keyword}{const} uword x\_it\_row = x\_it.row();}
\DoxyCodeLine{218     }
\DoxyCodeLine{219     \textcolor{keyword}{const} uword y\_it\_col = y\_it.col();}
\DoxyCodeLine{220     \textcolor{keyword}{const} uword y\_it\_row = y\_it.row();}
\DoxyCodeLine{221     }
\DoxyCodeLine{222     \textcolor{keywordtype}{bool} use\_y\_loc = \textcolor{keyword}{false};}
\DoxyCodeLine{223     }
\DoxyCodeLine{224     \textcolor{keywordflow}{if}(x\_it == y\_it)}
\DoxyCodeLine{225       \{}
\DoxyCodeLine{226       out\_val = ((*x\_it) > (*y\_it)) ? uword(1) : uword(0);}
\DoxyCodeLine{227       }
\DoxyCodeLine{228       ++x\_it;}
\DoxyCodeLine{229       ++y\_it;}
\DoxyCodeLine{230       \}}
\DoxyCodeLine{231     \textcolor{keywordflow}{else}}
\DoxyCodeLine{232       \{}
\DoxyCodeLine{233       \textcolor{keywordflow}{if}((x\_it\_col < y\_it\_col) || ((x\_it\_col == y\_it\_col) \&\& (x\_it\_row < y\_it\_row))) \textcolor{comment}{// if y is closer to the end}}
\DoxyCodeLine{234         \{}
\DoxyCodeLine{235         out\_val = ((*x\_it) > eT(0)) ? uword(1) : uword(0);}
\DoxyCodeLine{236         }
\DoxyCodeLine{237         ++x\_it;}
\DoxyCodeLine{238         \}}
\DoxyCodeLine{239       \textcolor{keywordflow}{else}}
\DoxyCodeLine{240         \{}
\DoxyCodeLine{241         out\_val = (eT(0) > (*y\_it)) ? uword(1) : uword(0);}
\DoxyCodeLine{242         }
\DoxyCodeLine{243         ++y\_it;}
\DoxyCodeLine{244         }
\DoxyCodeLine{245         use\_y\_loc = \textcolor{keyword}{true};}
\DoxyCodeLine{246         \}}
\DoxyCodeLine{247       \}}
\DoxyCodeLine{248     }
\DoxyCodeLine{249     \textcolor{keywordflow}{if}(out\_val != uword(0))}
\DoxyCodeLine{250       \{}
\DoxyCodeLine{251       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.values[count]) = out\_val;}
\DoxyCodeLine{252       }
\DoxyCodeLine{253       \textcolor{keyword}{const} uword out\_row = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_row : y\_it\_row;}
\DoxyCodeLine{254       \textcolor{keyword}{const} uword out\_col = (use\_y\_loc == \textcolor{keyword}{false}) ? x\_it\_col : y\_it\_col;}
\DoxyCodeLine{255       }
\DoxyCodeLine{256       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.row\_indices[count]) = out\_row;}
\DoxyCodeLine{257       \mbox{\hyperlink{classaccess_a90cb80857bc3814f3661fe952f7c97c4}{access::rw}}(out.col\_ptrs[out\_col + 1])++;}
\DoxyCodeLine{258       ++count;}
\DoxyCodeLine{259       \}}
\DoxyCodeLine{260     }
\DoxyCodeLine{261     \mbox{\hyperlink{group__debug_ga458beb676810b1e43df9f0668359e76f}{arma\_check}}( (count > max\_n\_nonzero