\hypertarget{glue__mvnrnd__meat_8hpp_source}{}\doxysection{glue\+\_\+mvnrnd\+\_\+meat.\+hpp}
\label{glue__mvnrnd__meat_8hpp_source}\index{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/glue\_mvnrnd\_meat.hpp@{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/glue\_mvnrnd\_meat.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright 2008-\/2016 Conrad Sanderson (http://conradsanderson.id.au)}}
\DoxyCodeLine{2 \textcolor{comment}{// Copyright 2008-\/2016 National ICT Australia (NICTA)}}
\DoxyCodeLine{3 \textcolor{comment}{// }}
\DoxyCodeLine{4 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{// http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{8 \textcolor{comment}{// }}
\DoxyCodeLine{9 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{10 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{11 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{12 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{13 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{19 }
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{comment}{// implementation based on:}}
\DoxyCodeLine{22 \textcolor{comment}{// James E. Gentle.}}
\DoxyCodeLine{23 \textcolor{comment}{// Generation of Random Numbers.}}
\DoxyCodeLine{24 \textcolor{comment}{// Computational Statistics, pp. 305-\/331, 2009.}}
\DoxyCodeLine{25 \textcolor{comment}{// http://dx.doi.org/10.1007/978-\/0-\/387-\/98144-\/4\_7}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{29 \textcolor{keyword}{inline}}
\DoxyCodeLine{30 \textcolor{keywordtype}{void}}
\DoxyCodeLine{31 glue\_mvnrnd\_vec::apply(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classGlue}{Glue<T1,T2,glue\_mvnrnd\_vec>}}\& expr)}
\DoxyCodeLine{32   \{}
\DoxyCodeLine{33   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{34   }
\DoxyCodeLine{35   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = glue\_mvnrnd::apply\_direct(out, expr.\mbox{\hyperlink{classGlue_a22423031a9f05101ad23dfd897c6f1ab}{A}}, expr.\mbox{\hyperlink{classGlue_a1b3a6b5891d84915448f3084e66476c6}{B}}, uword(1));}
\DoxyCodeLine{36   }
\DoxyCodeLine{37   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})}
\DoxyCodeLine{38     \{}
\DoxyCodeLine{39     out.soft\_reset();}
\DoxyCodeLine{40     arma\_stop\_runtime\_error(\textcolor{stringliteral}{"{}mvnrnd(): given covariance matrix is not symmetric positive semi-\/definite"{}});}
\DoxyCodeLine{41     \}}
\DoxyCodeLine{42   \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 }
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{47 \textcolor{keyword}{inline}}
\DoxyCodeLine{48 \textcolor{keywordtype}{void}}
\DoxyCodeLine{49 glue\_mvnrnd::apply(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classGlue}{Glue<T1,T2,glue\_mvnrnd>}}\& expr)}
\DoxyCodeLine{50   \{}
\DoxyCodeLine{51   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{52   }
\DoxyCodeLine{53   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = glue\_mvnrnd::apply\_direct(out, expr.\mbox{\hyperlink{classGlue_a22423031a9f05101ad23dfd897c6f1ab}{A}}, expr.\mbox{\hyperlink{classGlue_a1b3a6b5891d84915448f3084e66476c6}{B}}, expr.\mbox{\hyperlink{classGlue_a4f3211f4584d498b0563c3ac2ee4e256}{aux\_uword}});}
\DoxyCodeLine{54   }
\DoxyCodeLine{55   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})}
\DoxyCodeLine{56     \{}
\DoxyCodeLine{57     out.soft\_reset();}
\DoxyCodeLine{58     arma\_stop\_runtime\_error(\textcolor{stringliteral}{"{}mvnrnd(): given covariance matrix is not symmetric positive semi-\/definite"{}});}
\DoxyCodeLine{59     \}}
\DoxyCodeLine{60   \}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 }
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1, \textcolor{keyword}{typename} T2>}
\DoxyCodeLine{65 \textcolor{keyword}{inline}}
\DoxyCodeLine{66 \textcolor{keywordtype}{bool}}
\DoxyCodeLine{67 glue\_mvnrnd::apply\_direct(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<typename T1::elem\_type,T1>}}\& M, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<typename T1::elem\_type,T2>}}\& C, \textcolor{keyword}{const} uword N)}
\DoxyCodeLine{68   \{}
\DoxyCodeLine{69   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{70   }
\DoxyCodeLine{71   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{72   }
\DoxyCodeLine{73   \textcolor{keyword}{const} \mbox{\hyperlink{structquasi__unwrap}{quasi\_unwrap<T1>}} UM(M.get\_ref());}
\DoxyCodeLine{74   \textcolor{keyword}{const} \mbox{\hyperlink{structquasi__unwrap}{quasi\_unwrap<T2>}} UC(C.get\_ref());}
\DoxyCodeLine{75   }
\DoxyCodeLine{76   arma\_debug\_check( (UM.M.is\_colvec() == \textcolor{keyword}{false}) \&\& (UM.M.is\_empty() == \textcolor{keyword}{false}),  \textcolor{stringliteral}{"{}mvnrnd(): given mean must be a column vector"{}}     );}
\DoxyCodeLine{77   arma\_debug\_check( (UC.M.is\_square() == \textcolor{keyword}{false}),  \textcolor{stringliteral}{"{}mvnrnd(): given covariance matrix must be square sized"{}}                         );}
\DoxyCodeLine{78   arma\_debug\_check( (UM.M.n\_rows != UC.M.n\_rows), \textcolor{stringliteral}{"{}mvnrnd(): number of rows in given mean vector and covariance matrix must match"{}} );}
\DoxyCodeLine{79   }
\DoxyCodeLine{80   \textcolor{keywordflow}{if}( UM.M.is\_empty() || UC.M.is\_empty() )}
\DoxyCodeLine{81     \{}
\DoxyCodeLine{82     out.\mbox{\hyperlink{group__Mat_ga750c2d7d0bd0cf7b88e17a24db252438}{set\_size}}(0,N);}
\DoxyCodeLine{83     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85   }
\DoxyCodeLine{86   \textcolor{comment}{// if(auxlib::rudimentary\_sym\_check(UC.M) == false)}}
\DoxyCodeLine{87   \textcolor{comment}{//   \{}}
\DoxyCodeLine{88   \textcolor{comment}{//   arma\_debug\_warn\_level(1, "{}mvnrnd(): given matrix is not symmetric"{});}}
\DoxyCodeLine{89   \textcolor{comment}{//   return false;}}
\DoxyCodeLine{90   \textcolor{comment}{//   \}}}
\DoxyCodeLine{91   }
\DoxyCodeLine{92   \textcolor{keywordflow}{if}((arma\_config::debug) \&\& (auxlib::rudimentary\_sym\_check(UC.M) == \textcolor{keyword}{false}))}
\DoxyCodeLine{93     \{}
\DoxyCodeLine{94     arma\_debug\_warn\_level(1, \textcolor{stringliteral}{"{}mvnrnd(): given matrix is not symmetric"{}});}
\DoxyCodeLine{95     \}}
\DoxyCodeLine{96   }
\DoxyCodeLine{97   \textcolor{keywordtype}{bool} status = \textcolor{keyword}{false};}
\DoxyCodeLine{98   }
\DoxyCodeLine{99   \textcolor{keywordflow}{if}(UM.is\_alias(out) || UC.is\_alias(out))}
\DoxyCodeLine{100     \{}
\DoxyCodeLine{101     \mbox{\hyperlink{classMat}{Mat<eT>}} tmp;}
\DoxyCodeLine{102     }
\DoxyCodeLine{103     status = glue\_mvnrnd::apply\_noalias(tmp, UM.M, UC.M, N);}
\DoxyCodeLine{104     }
\DoxyCodeLine{105     out.\mbox{\hyperlink{group__Mat_gaff06a75771f96605f7cc4f8c6b3fceb7}{steal\_mem}}(tmp);}
\DoxyCodeLine{106     \}}
\DoxyCodeLine{107   \textcolor{keywordflow}{else}}
\DoxyCodeLine{108     \{}
\DoxyCodeLine{109     status = glue\_mvnrnd::apply\_noalias(out, UM.M, UC.M, N);}
\DoxyCodeLine{110     \}}
\DoxyCodeLine{111   }
\DoxyCodeLine{112   \textcolor{keywordflow}{return} status;}
\DoxyCodeLine{113   \}}
\DoxyCodeLine{114 }
\DoxyCodeLine{115 }
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{keyword}{template}<\textcolor{keyword}{typename} eT>}
\DoxyCodeLine{118 \textcolor{keyword}{inline}}
\DoxyCodeLine{119 \textcolor{keywordtype}{bool}}
\DoxyCodeLine{120 glue\_mvnrnd::apply\_noalias(\mbox{\hyperlink{classMat}{Mat<eT>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classMat}{Mat<eT>}}\& M, \textcolor{keyword}{const} \mbox{\hyperlink{classMat}{Mat<eT>}}\& C, \textcolor{keyword}{const} uword N)}
\DoxyCodeLine{121   \{}
\DoxyCodeLine{122   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{123   }
\DoxyCodeLine{124   \mbox{\hyperlink{classMat}{Mat<eT>}} D;}
\DoxyCodeLine{125   }
\DoxyCodeLine{126   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} chol\_status = op\_chol::apply\_direct(D, C, 1);  \textcolor{comment}{// '1' means "{}lower triangular"{}}}
\DoxyCodeLine{127   }
\DoxyCodeLine{128   \textcolor{keywordflow}{if}(chol\_status == \textcolor{keyword}{false})}
\DoxyCodeLine{129     \{}
\DoxyCodeLine{130     \textcolor{comment}{// C is not symmetric positive definite, so find approximate square root of C}}
\DoxyCodeLine{131     }
\DoxyCodeLine{132     \mbox{\hyperlink{classCol}{Col<eT>}} eigval;  \textcolor{comment}{// NOTE: eT is constrained to be real (ie. float or double) in fn\_mvnrnd.hpp}}
\DoxyCodeLine{133     \mbox{\hyperlink{classMat}{Mat<eT>}} eigvec;}
\DoxyCodeLine{134     }
\DoxyCodeLine{135     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} eig\_status = \mbox{\hyperlink{group__fn__eig__sym_gac55fe3206226539aa46643bc8ac9abe2}{eig\_sym\_helper}}(eigval, eigvec, C, \textcolor{charliteral}{'d'}, \textcolor{stringliteral}{"{}mvnrnd()"{}});}
\DoxyCodeLine{136     }
\DoxyCodeLine{137     \textcolor{keywordflow}{if}(eig\_status == \textcolor{keyword}{false})  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{138     }
\DoxyCodeLine{139           eT*   eigval\_mem    = eigval.\mbox{\hyperlink{group__Mat_gad5b1b46a9288e04128aa11c99cc2b444}{memptr}}();}
\DoxyCodeLine{140     \textcolor{keyword}{const} uword eigval\_n\_elem = eigval.\mbox{\hyperlink{classMat_a89f0d40af94b6521edd06645a0d68fd4}{n\_elem}};}
\DoxyCodeLine{141     }
\DoxyCodeLine{142     \textcolor{comment}{// since we're doing an approximation, tolerate tiny negative eigenvalues}}
\DoxyCodeLine{143     }
\DoxyCodeLine{144     \textcolor{keyword}{const} eT tol = eT(-\/100) * \mbox{\hyperlink{classDatum}{Datum<eT>::eps}} * norm(C, \textcolor{stringliteral}{"{}fro"{}});}
\DoxyCodeLine{145     }
\DoxyCodeLine{146     \textcolor{keywordflow}{if}(arma\_isfinite(tol) == \textcolor{keyword}{false})  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{147     }
\DoxyCodeLine{148     \textcolor{keywordflow}{for}(uword i=0; i<eigval\_n\_elem; ++i)}
\DoxyCodeLine{149       \{}
\DoxyCodeLine{150       \textcolor{keyword}{const} eT val = eigval\_mem[i];}
\DoxyCodeLine{151       }
\DoxyCodeLine{152       \textcolor{keywordflow}{if}( (val < tol) || (arma\_isfinite(val) == \textcolor{keyword}{false}) )  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{153       \}}
\DoxyCodeLine{154     }
\DoxyCodeLine{155     \textcolor{keywordflow}{for}(uword i=0; i<eigval\_n\_elem; ++i)  \{ \textcolor{keywordflow}{if}(eigval\_mem[i] < eT(0))  \{ eigval\_mem[i] = eT(0); \} \}}
\DoxyCodeLine{156     }
\DoxyCodeLine{157     \mbox{\hyperlink{classMat}{Mat<eT>}} DD = eigvec * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(sqrt(eigval));}
\DoxyCodeLine{158     }
\DoxyCodeLine{159     D.\mbox{\hyperlink{group__Mat_gaff06a75771f96605f7cc4f8c6b3fceb7}{steal\_mem}}(DD);}
\DoxyCodeLine{160     \}}
\DoxyCodeLine{161   }
\DoxyCodeLine{162   out = D * randn< Mat<eT> >(M.\mbox{\hyperlink{classMat_a751755caeae1d831a1c27049740e7360}{n\_rows}}, N);}
\DoxyCodeLine{163     }
\DoxyCodeLine{164   \textcolor{keywordflow}{if}(N == 1)}
\DoxyCodeLine{165     \{}
\DoxyCodeLine{166     out += M;}
\DoxyCodeLine{167     \}}
\DoxyCodeLine{168   \textcolor{keywordflow}{else}}
\DoxyCodeLine{169   \textcolor{keywordflow}{if}(N > 1)}
\DoxyCodeLine{170     \{}
\DoxyCodeLine{171     out.each\_col() += M;}
\DoxyCodeLine{172     \}}
\DoxyCodeLine{173   }
\DoxyCodeLine{174   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{175   \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 }
\DoxyCodeLine{178 }

\end{DoxyCode}
