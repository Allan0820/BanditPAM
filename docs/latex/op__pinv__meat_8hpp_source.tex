\hypertarget{op__pinv__meat_8hpp_source}{}\doxysection{op\+\_\+pinv\+\_\+meat.\+hpp}
\label{op__pinv__meat_8hpp_source}\index{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/op\_pinv\_meat.hpp@{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/op\_pinv\_meat.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright 2008-\/2016 Conrad Sanderson (http://conradsanderson.id.au)}}
\DoxyCodeLine{2 \textcolor{comment}{// Copyright 2008-\/2016 National ICT Australia (NICTA)}}
\DoxyCodeLine{3 \textcolor{comment}{// }}
\DoxyCodeLine{4 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{// http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{8 \textcolor{comment}{// }}
\DoxyCodeLine{9 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{10 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{11 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{12 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{13 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{17 }
\DoxyCodeLine{20 }
\DoxyCodeLine{21 }
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{24 \textcolor{keyword}{inline}}
\DoxyCodeLine{25 \textcolor{keywordtype}{void}}
\DoxyCodeLine{26 op\_pinv::apply(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classOp}{Op<T1,op\_pinv>}}\& in)}
\DoxyCodeLine{27   \{}
\DoxyCodeLine{28   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{29   }
\DoxyCodeLine{30   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::pod\_type T;}
\DoxyCodeLine{31   }
\DoxyCodeLine{32   \textcolor{keyword}{const} T     tol       = \mbox{\hyperlink{classaccess_a9687cee4d2be0fe591998d6f5c6d0849}{access::tmp\_real}}(in.\mbox{\hyperlink{classOp_a6bedb670e7a17e7f713333b55aaacf9a}{aux}});}
\DoxyCodeLine{33   \textcolor{keyword}{const} uword method\_id = in.\mbox{\hyperlink{classOp_a197cb9330fe0d72c976d6223514c4bd6}{aux\_uword\_a}};}
\DoxyCodeLine{34   }
\DoxyCodeLine{35   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = op\_pinv::apply\_direct(out, in.\mbox{\hyperlink{classOp_af7ab7221b6e233cdd38b9f9b69f301ce}{m}}, tol, method\_id);}
\DoxyCodeLine{36   }
\DoxyCodeLine{37   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})}
\DoxyCodeLine{38     \{}
\DoxyCodeLine{39     out.soft\_reset();}
\DoxyCodeLine{40     arma\_stop\_runtime\_error(\textcolor{stringliteral}{"{}pinv(): svd failed"{}});}
\DoxyCodeLine{41     \}}
\DoxyCodeLine{42   \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 }
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{47 \textcolor{keyword}{inline}}
\DoxyCodeLine{48 \textcolor{keywordtype}{bool}}
\DoxyCodeLine{49 op\_pinv::apply\_direct(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<typename T1::elem\_type,T1>}}\& expr, \textcolor{keyword}{typename} T1::pod\_type tol, \textcolor{keyword}{const} uword method\_id)}
\DoxyCodeLine{50   \{}
\DoxyCodeLine{51   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{52   }
\DoxyCodeLine{53   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{54   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::pod\_type   T;}
\DoxyCodeLine{55   }
\DoxyCodeLine{56   arma\_debug\_check((tol < T(0)), \textcolor{stringliteral}{"{}pinv(): tolerance must be >= 0"{}});}
\DoxyCodeLine{57   }
\DoxyCodeLine{58   \textcolor{comment}{// method\_id = 0 -\/> default setting}}
\DoxyCodeLine{59   \textcolor{comment}{// method\_id = 1 -\/> use standard algorithm}}
\DoxyCodeLine{60   \textcolor{comment}{// method\_id = 2 -\/> use divide and conquer algorithm}}
\DoxyCodeLine{61   }
\DoxyCodeLine{62   \mbox{\hyperlink{classMat}{Mat<eT>}} \mbox{\hyperlink{structA}{A}}(expr.get\_ref());}
\DoxyCodeLine{63   }
\DoxyCodeLine{64   \textcolor{keyword}{const} uword n\_rows = \mbox{\hyperlink{structA}{A}}.n\_rows;}
\DoxyCodeLine{65   \textcolor{keyword}{const} uword n\_cols = \mbox{\hyperlink{structA}{A}}.n\_cols;}
\DoxyCodeLine{66   }
\DoxyCodeLine{67   \textcolor{keywordflow}{if}(\mbox{\hyperlink{structA}{A}}.is\_empty())  \{ out.\mbox{\hyperlink{group__Mat_ga750c2d7d0bd0cf7b88e17a24db252438}{set\_size}}(n\_cols,n\_rows); \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}
\DoxyCodeLine{68   }
\DoxyCodeLine{69 \textcolor{preprocessor}{  \#if defined(ARMA\_OPTIMISE\_SYMPD)}}
\DoxyCodeLine{70     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} try\_sympd = (auxlib::crippled\_lapack(\mbox{\hyperlink{structA}{A}}) == \textcolor{keyword}{false}) \&\& (tol == T(0)) \&\& (method\_id == uword(0)) \&\& sympd\_helper::guess\_sympd\_anysize(\mbox{\hyperlink{structA}{A}});}
\DoxyCodeLine{71 \textcolor{preprocessor}{  \#else}}
\DoxyCodeLine{72     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} try\_sympd = \textcolor{keyword}{false};}
\DoxyCodeLine{73 \textcolor{preprocessor}{  \#endif}}
\DoxyCodeLine{74   }
\DoxyCodeLine{75   \textcolor{keywordflow}{if}(try\_sympd)}
\DoxyCodeLine{76     \{}
\DoxyCodeLine{77     arma\_extra\_debug\_print(\textcolor{stringliteral}{"{}op\_pinv: attempting sympd optimisation"{}});}
\DoxyCodeLine{78     }
\DoxyCodeLine{79     out = \mbox{\hyperlink{structA}{A}};}
\DoxyCodeLine{80     }
\DoxyCodeLine{81     \textcolor{keyword}{const} T rcond\_threshold = T((\mbox{\hyperlink{group__fn__max_gaf2317ac99c92ae7a239291d01a615893}{std::max}})(uword(100), uword(\mbox{\hyperlink{structA}{A}}.n\_rows))) * std::numeric\_limits<T>::epsilon();}
\DoxyCodeLine{82     }
\DoxyCodeLine{83     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = auxlib::inv\_sympd\_rcond(out, rcond\_threshold);}
\DoxyCodeLine{84     }
\DoxyCodeLine{85     \textcolor{keywordflow}{if}(status)  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}
\DoxyCodeLine{86     }
\DoxyCodeLine{87     arma\_extra\_debug\_print(\textcolor{stringliteral}{"{}op\_pinv: sympd optimisation failed"{}});}
\DoxyCodeLine{88     \textcolor{comment}{// auxlib::inv\_sympd\_rcond() will fail if A isn't really positive definite or its rcond is below rcond\_threshold}}
\DoxyCodeLine{89     \}}
\DoxyCodeLine{90   }
\DoxyCodeLine{91   \textcolor{comment}{// economical SVD decomposition }}
\DoxyCodeLine{92   \mbox{\hyperlink{classMat}{Mat<eT>}} U;}
\DoxyCodeLine{93   \mbox{\hyperlink{classCol}{Col< T>}} s;}
\DoxyCodeLine{94   \mbox{\hyperlink{classMat}{Mat<eT>}} V;}
\DoxyCodeLine{95   }
\DoxyCodeLine{96   \textcolor{keywordflow}{if}(n\_cols > n\_rows)  \{ \mbox{\hyperlink{structA}{A}} = trans(\mbox{\hyperlink{structA}{A}}); \}}
\DoxyCodeLine{97   }
\DoxyCodeLine{98   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = ((method\_id == uword(0)) || (method\_id == uword(2))) ? auxlib::svd\_dc\_econ(U, s, V, \mbox{\hyperlink{structA}{A}}) : \mbox{\hyperlink{classauxlib}{auxlib}}::svd\_econ(U, s, V, \mbox{\hyperlink{structA}{A}}, \textcolor{stringliteral}{'b'});}
\DoxyCodeLine{99   }
\DoxyCodeLine{100   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{101   }
\DoxyCodeLine{102   \textcolor{keyword}{const} uword s\_n\_elem = s.\mbox{\hyperlink{classMat_a89f0d40af94b6521edd06645a0d68fd4}{n\_elem}};}
\DoxyCodeLine{103   \textcolor{keyword}{const} T*    s\_mem    = s.\mbox{\hyperlink{group__Mat_gad5b1b46a9288e04128aa11c99cc2b444}{memptr}}();}
\DoxyCodeLine{104   }
\DoxyCodeLine{105   \textcolor{comment}{// set tolerance to default if it hasn't been specified}}
\DoxyCodeLine{106   \textcolor{keywordflow}{if}( (tol == T(0)) \&\& (s\_n\_elem > 0) )}
\DoxyCodeLine{107     \{}
\DoxyCodeLine{108     tol = (\mbox{\hyperlink{group__fn__max_gaf2317ac99c92ae7a239291d01a615893}{std::max}})(n\_rows, n\_cols) * s\_mem[0] * std::numeric\_limits<T>::epsilon();}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110   }
\DoxyCodeLine{111   }
\DoxyCodeLine{112   uword count = 0;}
\DoxyCodeLine{113   }
\DoxyCodeLine{114   \textcolor{keywordflow}{for}(uword i = 0; i < s\_n\_elem; ++i)  \{ count += (s\_mem[i] >= tol) ? uword(1) : uword(0); \}}
\DoxyCodeLine{115   }
\DoxyCodeLine{116   \textcolor{keywordflow}{if}(count == 0)  \{ out.zeros(n\_cols, n\_rows); \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}
\DoxyCodeLine{117   }
\DoxyCodeLine{118   \mbox{\hyperlink{classCol}{Col<T>}} s2(count, \mbox{\hyperlink{structarma__nozeros__indicator}{arma\_nozeros\_indicator}}());}
\DoxyCodeLine{119   }
\DoxyCodeLine{120   T* s2\_mem = s2.memptr();}
\DoxyCodeLine{121   }
\DoxyCodeLine{122   uword count2 = 0;}
\DoxyCodeLine{123   }
\DoxyCodeLine{124   \textcolor{keywordflow}{for}(uword i=0; i < s\_n\_elem; ++i)}
\DoxyCodeLine{125     \{}
\DoxyCodeLine{126     \textcolor{keyword}{const} T val = s\_mem[i];}
\DoxyCodeLine{127     }
\DoxyCodeLine{128     \textcolor{keywordflow}{if}(val >= tol)  \{ s2\_mem[count2] = (val > T(0)) ? T(T(1) / val) : T(0); ++count2; \}}
\DoxyCodeLine{129     \}}
\DoxyCodeLine{130   }
\DoxyCodeLine{131   }
\DoxyCodeLine{132   \mbox{\hyperlink{classMat}{Mat<eT>}} tmp;}
\DoxyCodeLine{133     }
\DoxyCodeLine{134   \textcolor{keywordflow}{if}(n\_rows >= n\_cols)}
\DoxyCodeLine{135     \{}
\DoxyCodeLine{136     \textcolor{comment}{// out = ( (V.n\_cols > count) ? V.cols(0,count-\/1) : V ) * diagmat(s2) * trans( (U.n\_cols > count) ? U.cols(0,count-\/1) : U );}}
\DoxyCodeLine{137     }
\DoxyCodeLine{138     \textcolor{keywordflow}{if}(count < V.\mbox{\hyperlink{classMat_ae4f28b81d1d7ace8ae86d0787f2fd367}{n\_cols}})}
\DoxyCodeLine{139       \{}
\DoxyCodeLine{140       tmp = V.\mbox{\hyperlink{group__Mat_ga37d3669348116f17e41410adb1b39eab}{cols}}(0,count-\/1) * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(s2);}
\DoxyCodeLine{141       \}}
\DoxyCodeLine{142     \textcolor{keywordflow}{else}}
\DoxyCodeLine{143       \{}
\DoxyCodeLine{144       tmp = V * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(s2);}
\DoxyCodeLine{145       \}}
\DoxyCodeLine{146     }
\DoxyCodeLine{147     \textcolor{keywordflow}{if}(count < U.\mbox{\hyperlink{classMat_ae4f28b81d1d7ace8ae86d0787f2fd367}{n\_cols}})}
\DoxyCodeLine{148       \{}
\DoxyCodeLine{149       out = tmp * trans(U.\mbox{\hyperlink{group__Mat_ga37d3669348116f17e41410adb1b39eab}{cols}}(0,count-\/1));}
\DoxyCodeLine{150       \}}
\DoxyCodeLine{151     \textcolor{keywordflow}{else}}
\DoxyCodeLine{152       \{}
\DoxyCodeLine{153       out = tmp * trans(U);}
\DoxyCodeLine{154       \}}
\DoxyCodeLine{155     \}}
\DoxyCodeLine{156   \textcolor{keywordflow}{else}}
\DoxyCodeLine{157     \{}
\DoxyCodeLine{158     \textcolor{comment}{// out = ( (U.n\_cols > count) ? U.cols(0,count-\/1) : U ) * diagmat(s2) * trans( (V.n\_cols > count) ? V.cols(0,count-\/1) : V );}}
\DoxyCodeLine{159     }
\DoxyCodeLine{160     \textcolor{keywordflow}{if}(count < U.\mbox{\hyperlink{classMat_ae4f28b81d1d7ace8ae86d0787f2fd367}{n\_cols}})}
\DoxyCodeLine{161       \{}
\DoxyCodeLine{162       tmp = U.\mbox{\hyperlink{group__Mat_ga37d3669348116f17e41410adb1b39eab}{cols}}(0,count-\/1) * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(s2);}
\DoxyCodeLine{163       \}}
\DoxyCodeLine{164     \textcolor{keywordflow}{else}}
\DoxyCodeLine{165       \{}
\DoxyCodeLine{166       tmp = U * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(s2);}
\DoxyCodeLine{167       \}}
\DoxyCodeLine{168     }
\DoxyCodeLine{169     \textcolor{keywordflow}{if}(count < V.\mbox{\hyperlink{classMat_ae4f28b81d1d7ace8ae86d0787f2fd367}{n\_cols}})}
\DoxyCodeLine{170       \{}
\DoxyCodeLine{171       out = tmp * trans(V.\mbox{\hyperlink{group__Mat_ga37d3669348116f17e41410adb1b39eab}{cols}}(0,count-\/1));}
\DoxyCodeLine{172       \}}
\DoxyCodeLine{173     \textcolor{keywordflow}{else}}
\DoxyCodeLine{174       \{}
\DoxyCodeLine{175       out = tmp * trans(V);}
\DoxyCodeLine{176       \}}
\DoxyCodeLine{177     \}}
\DoxyCodeLine{178   }
\DoxyCodeLine{179   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{180   \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{182 }
\DoxyCodeLine{183 }

\end{DoxyCode}
