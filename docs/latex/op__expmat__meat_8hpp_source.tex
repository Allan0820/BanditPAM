\hypertarget{op__expmat__meat_8hpp_source}{}\doxysection{op\+\_\+expmat\+\_\+meat.\+hpp}
\label{op__expmat__meat_8hpp_source}\index{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/op\_expmat\_meat.hpp@{/Users/motiwari/Desktop/BanditPAM/headers/carma/extern/armadillo-\/code/include/armadillo\_bits/op\_expmat\_meat.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright 2008-\/2016 Conrad Sanderson (http://conradsanderson.id.au)}}
\DoxyCodeLine{2 \textcolor{comment}{// Copyright 2008-\/2016 National ICT Australia (NICTA)}}
\DoxyCodeLine{3 \textcolor{comment}{// }}
\DoxyCodeLine{4 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{// http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{8 \textcolor{comment}{// }}
\DoxyCodeLine{9 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{10 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{11 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{12 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{13 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{17 }
\DoxyCodeLine{20 }
\DoxyCodeLine{21 }
\DoxyCodeLine{27 }
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{30 \textcolor{keyword}{inline}}
\DoxyCodeLine{31 \textcolor{keywordtype}{void}}
\DoxyCodeLine{32 \mbox{\hyperlink{group__op__expmat_gaea6692731949a079d902ef1e95d97cb9}{op\_expmat::apply}}(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classOp}{Op<T1, op\_expmat>}}\& expr)}
\DoxyCodeLine{33   \{}
\DoxyCodeLine{34   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{35   }
\DoxyCodeLine{36   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = op\_expmat::apply\_direct(out, expr.\mbox{\hyperlink{classOp_af7ab7221b6e233cdd38b9f9b69f301ce}{m}});}
\DoxyCodeLine{37   }
\DoxyCodeLine{38   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})}
\DoxyCodeLine{39     \{}
\DoxyCodeLine{40     out.soft\_reset();}
\DoxyCodeLine{41     arma\_stop\_runtime\_error(\textcolor{stringliteral}{"{}expmat(): given matrix appears ill-\/conditioned"{}});}
\DoxyCodeLine{42     \}}
\DoxyCodeLine{43   \}}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 }
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{48 \textcolor{keyword}{inline}}
\DoxyCodeLine{49 \textcolor{keywordtype}{bool}}
\DoxyCodeLine{50 op\_expmat::apply\_direct(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<typename T1::elem\_type, T1>}}\& expr)}
\DoxyCodeLine{51   \{}
\DoxyCodeLine{52   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{53   }
\DoxyCodeLine{54   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{55   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::pod\_type   T;}
\DoxyCodeLine{56   }
\DoxyCodeLine{57   \textcolor{keywordflow}{if}(\mbox{\hyperlink{structis__op__diagmat}{is\_op\_diagmat<T1>::value}})}
\DoxyCodeLine{58     \{}
\DoxyCodeLine{59     out = expr.get\_ref();  \textcolor{comment}{// force the evaluation of diagmat()}}
\DoxyCodeLine{60     }
\DoxyCodeLine{61     arma\_debug\_check( (out.\mbox{\hyperlink{group__Mat_ga1f860b22491beb19251642270d04d8f1}{is\_square}}() == \textcolor{keyword}{false}), \textcolor{stringliteral}{"{}expmat(): given matrix must be square sized"{}} );}
\DoxyCodeLine{62     }
\DoxyCodeLine{63     \textcolor{keyword}{const} uword N = (\mbox{\hyperlink{group__fn__min_gac69a480b4c714f7ecbb0620aaa757c8a}{std::min}})(out.\mbox{\hyperlink{classMat_a751755caeae1d831a1c27049740e7360}{n\_rows}}, out.\mbox{\hyperlink{classMat_ae4f28b81d1d7ace8ae86d0787f2fd367}{n\_cols}});}
\DoxyCodeLine{64     }
\DoxyCodeLine{65     \textcolor{keywordflow}{for}(uword i=0; i<N; ++i)  \{ out.\mbox{\hyperlink{group__Mat_ga62c874c45807d7853afd231ae9f512d7}{at}}(i,i) = std::exp( out.\mbox{\hyperlink{group__Mat_ga62c874c45807d7853afd231ae9f512d7}{at}}(i,i) ); \}}
\DoxyCodeLine{66     \}}
\DoxyCodeLine{67   \textcolor{keywordflow}{else}}
\DoxyCodeLine{68     \{}
\DoxyCodeLine{69     \mbox{\hyperlink{classMat}{Mat<eT>}} \mbox{\hyperlink{structA}{A}} = expr.get\_ref();}
\DoxyCodeLine{70     }
\DoxyCodeLine{71     arma\_debug\_check( (\mbox{\hyperlink{structA}{A}}.is\_square() == \textcolor{keyword}{false}), \textcolor{stringliteral}{"{}expmat(): given matrix must be square sized"{}} );}
\DoxyCodeLine{72     }
\DoxyCodeLine{73     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structA}{A}}.is\_diagmat())}
\DoxyCodeLine{74       \{}
\DoxyCodeLine{75       \textcolor{keyword}{const} uword N = (\mbox{\hyperlink{group__fn__min_gac69a480b4c714f7ecbb0620aaa757c8a}{std::min}})(\mbox{\hyperlink{structA}{A}}.n\_rows, \mbox{\hyperlink{structA}{A}}.n\_cols);}
\DoxyCodeLine{76       }
\DoxyCodeLine{77       out.zeros(N,N);}
\DoxyCodeLine{78       }
\DoxyCodeLine{79       \textcolor{keywordflow}{for}(uword i=0; i<N; ++i)  \{ out.\mbox{\hyperlink{group__Mat_ga62c874c45807d7853afd231ae9f512d7}{at}}(i,i) = std::exp( \mbox{\hyperlink{structA}{A}}.at(i,i) ); \}}
\DoxyCodeLine{80       }
\DoxyCodeLine{81       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{82       \}}
\DoxyCodeLine{83     }
\DoxyCodeLine{84 \textcolor{preprocessor}{    \#if defined(ARMA\_OPTIMISE\_SYMPD)}}
\DoxyCodeLine{85       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} try\_sympd = sympd\_helper::guess\_sympd\_anysize(\mbox{\hyperlink{structA}{A}});}
\DoxyCodeLine{86 \textcolor{preprocessor}{    \#else}}
\DoxyCodeLine{87       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} try\_sympd = \textcolor{keyword}{false};}
\DoxyCodeLine{88 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{89     }
\DoxyCodeLine{90     \textcolor{keywordflow}{if}(try\_sympd)}
\DoxyCodeLine{91       \{}
\DoxyCodeLine{92       arma\_extra\_debug\_print(\textcolor{stringliteral}{"{}op\_expmat: attempting sympd optimisation"{}});}
\DoxyCodeLine{93       }
\DoxyCodeLine{94       \textcolor{comment}{// if matrix A is sympd, all its eigenvalues are positive}}
\DoxyCodeLine{95       }
\DoxyCodeLine{96       \mbox{\hyperlink{classCol}{Col< T>}} eigval;}
\DoxyCodeLine{97       \mbox{\hyperlink{classMat}{Mat<eT>}} eigvec;}
\DoxyCodeLine{98       }
\DoxyCodeLine{99       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} eig\_status = \mbox{\hyperlink{group__fn__eig__sym_gac55fe3206226539aa46643bc8ac9abe2}{eig\_sym\_helper}}(eigval, eigvec, \mbox{\hyperlink{structA}{A}}, \textcolor{charliteral}{'d'}, \textcolor{stringliteral}{"{}expmat()"{}});}
\DoxyCodeLine{100       }
\DoxyCodeLine{101       \textcolor{keywordflow}{if}(eig\_status)}
\DoxyCodeLine{102         \{}
\DoxyCodeLine{103         eigval = exp(eigval);}
\DoxyCodeLine{104         }
\DoxyCodeLine{105         out = eigvec * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(eigval) * eigvec.t();}
\DoxyCodeLine{106         }
\DoxyCodeLine{107         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{108         \}}
\DoxyCodeLine{109       }
\DoxyCodeLine{110       arma\_extra\_debug\_print(\textcolor{stringliteral}{"{}op\_expmat: sympd optimisation failed"{}});}
\DoxyCodeLine{111       }
\DoxyCodeLine{112       \textcolor{comment}{// fallthrough if eigen decomposition failed}}
\DoxyCodeLine{113       \}}
\DoxyCodeLine{114     }
\DoxyCodeLine{115     \textcolor{keyword}{const} T norm\_val = arma::norm(\mbox{\hyperlink{structA}{A}}, \textcolor{stringliteral}{"{}inf"{}});}
\DoxyCodeLine{116     }
\DoxyCodeLine{117     \textcolor{keyword}{const} \textcolor{keywordtype}{double} log2\_val = (norm\_val > T(0)) ? \textcolor{keywordtype}{double}(eop\_aux::log2(norm\_val)) : \textcolor{keywordtype}{double}(0);}
\DoxyCodeLine{118     }
\DoxyCodeLine{119     \textcolor{keywordtype}{int} exponent = int(0);  std::frexp(log2\_val, \&exponent);}
\DoxyCodeLine{120     }
\DoxyCodeLine{121     \textcolor{keyword}{const} uword s = uword( (\mbox{\hyperlink{group__fn__max_gaf2317ac99c92ae7a239291d01a615893}{std::max}})(\textcolor{keywordtype}{int}(0), exponent + \textcolor{keywordtype}{int}(1)) );}
\DoxyCodeLine{122     }
\DoxyCodeLine{123     \mbox{\hyperlink{structA}{A}} /= eT(eop\_aux::pow(\textcolor{keywordtype}{double}(2), \textcolor{keywordtype}{double}(s)));}
\DoxyCodeLine{124     }
\DoxyCodeLine{125     T c = T(0.5);}
\DoxyCodeLine{126     }
\DoxyCodeLine{127     \mbox{\hyperlink{classMat}{Mat<eT>}} E(\mbox{\hyperlink{structA}{A}}.n\_rows, \mbox{\hyperlink{structA}{A}}.n\_rows, fill::eye);  E += c * \mbox{\hyperlink{structA}{A}};}
\DoxyCodeLine{128     \mbox{\hyperlink{classMat}{Mat<eT>}} D(\mbox{\hyperlink{structA}{A}}.n\_rows, \mbox{\hyperlink{structA}{A}}.n\_rows, fill::eye);  D -\/= c * \mbox{\hyperlink{structA}{A}};}
\DoxyCodeLine{129     }
\DoxyCodeLine{130     \mbox{\hyperlink{classMat}{Mat<eT>}} X = \mbox{\hyperlink{structA}{A}};}
\DoxyCodeLine{131     }
\DoxyCodeLine{132     \textcolor{keywordtype}{bool} positive = \textcolor{keyword}{true};}
\DoxyCodeLine{133     }
\DoxyCodeLine{134     \textcolor{keyword}{const} uword N = 6;}
\DoxyCodeLine{135     }
\DoxyCodeLine{136     \textcolor{keywordflow}{for}(uword i = 2; i <= N; ++i)}
\DoxyCodeLine{137       \{}
\DoxyCodeLine{138       c = c * T(N -\/ i + 1) / T(i * (2*N -\/ i + 1));}
\DoxyCodeLine{139       }
\DoxyCodeLine{140       X = \mbox{\hyperlink{structA}{A}} * X;}
\DoxyCodeLine{141       }
\DoxyCodeLine{142       E += c * X;}
\DoxyCodeLine{143       }
\DoxyCodeLine{144       \textcolor{keywordflow}{if}(positive)  \{ D += c * X; \}  \textcolor{keywordflow}{else}  \{ D -\/= c * X; \}}
\DoxyCodeLine{145       }
\DoxyCodeLine{146       positive = (positive) ? \textcolor{keyword}{false} : \textcolor{keyword}{true};}
\DoxyCodeLine{147       \}}
\DoxyCodeLine{148     }
\DoxyCodeLine{149     \textcolor{keywordflow}{if}( (D.is\_finite() == \textcolor{keyword}{false}) || (E.is\_finite() == \textcolor{keyword}{false}) )  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{150     }
\DoxyCodeLine{151     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = solve(out, D, E, solve\_opts::no\_approx);}
\DoxyCodeLine{152     }
\DoxyCodeLine{153     \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{154     }
\DoxyCodeLine{155     \textcolor{keywordflow}{for}(uword i=0; i < s; ++i)  \{ out = out * out; \}}
\DoxyCodeLine{156     \}}
\DoxyCodeLine{157   }
\DoxyCodeLine{158   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{159   \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 }
\DoxyCodeLine{162 }
\DoxyCodeLine{163 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{164 \textcolor{keyword}{inline}}
\DoxyCodeLine{165 \textcolor{keywordtype}{void}}
\DoxyCodeLine{166 op\_expmat\_sym::apply(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{classOp}{Op<T1,op\_expmat\_sym>}}\& in)}
\DoxyCodeLine{167   \{}
\DoxyCodeLine{168   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{169   }
\DoxyCodeLine{170   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = op\_expmat\_sym::apply\_direct(out, in.\mbox{\hyperlink{classOp_af7ab7221b6e233cdd38b9f9b69f301ce}{m}});}
\DoxyCodeLine{171   }
\DoxyCodeLine{172   \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})}
\DoxyCodeLine{173     \{}
\DoxyCodeLine{174     out.soft\_reset();}
\DoxyCodeLine{175     arma\_stop\_runtime\_error(\textcolor{stringliteral}{"{}expmat\_sym(): transformation failed"{}});}
\DoxyCodeLine{176     \}}
\DoxyCodeLine{177   \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179 }
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T1>}
\DoxyCodeLine{182 \textcolor{keyword}{inline}}
\DoxyCodeLine{183 \textcolor{keywordtype}{bool}}
\DoxyCodeLine{184 op\_expmat\_sym::apply\_direct(\mbox{\hyperlink{classMat}{Mat<typename T1::elem\_type>}}\& out, \textcolor{keyword}{const} \mbox{\hyperlink{structBase}{Base<typename T1::elem\_type,T1>}}\& expr)}
\DoxyCodeLine{185   \{}
\DoxyCodeLine{186   arma\_extra\_debug\_sigprint();}
\DoxyCodeLine{187   }
\DoxyCodeLine{188 \textcolor{preprocessor}{  \#if defined(ARMA\_USE\_LAPACK)}}
\DoxyCodeLine{189     \{}
\DoxyCodeLine{190     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::pod\_type   T;}
\DoxyCodeLine{191     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} T1::elem\_type eT;}
\DoxyCodeLine{192     }
\DoxyCodeLine{193     \textcolor{keyword}{const} \mbox{\hyperlink{structunwrap}{unwrap<T1>}}   U(expr.get\_ref());}
\DoxyCodeLine{194     \textcolor{keyword}{const} \mbox{\hyperlink{classMat}{Mat<eT>}}\& X = U.M;}
\DoxyCodeLine{195     }
\DoxyCodeLine{196     arma\_debug\_check( (X.is\_square() == \textcolor{keyword}{false}), \textcolor{stringliteral}{"{}expmat\_sym(): given matrix must be square sized"{}} );}
\DoxyCodeLine{197     }
\DoxyCodeLine{198     \mbox{\hyperlink{classCol}{Col< T>}} eigval;}
\DoxyCodeLine{199     \mbox{\hyperlink{classMat}{Mat<eT>}} eigvec;}
\DoxyCodeLine{200     }
\DoxyCodeLine{201     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} status = \mbox{\hyperlink{group__fn__eig__sym_gac55fe3206226539aa46643bc8ac9abe2}{eig\_sym\_helper}}(eigval, eigvec, X, \textcolor{charliteral}{'d'}, \textcolor{stringliteral}{"{}expmat\_sym()"{}});}
\DoxyCodeLine{202     }
\DoxyCodeLine{203     \textcolor{keywordflow}{if}(status == \textcolor{keyword}{false})  \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}
\DoxyCodeLine{204     }
\DoxyCodeLine{205     eigval = exp(eigval);}
\DoxyCodeLine{206     }
\DoxyCodeLine{207     out = eigvec * \mbox{\hyperlink{group__fn__diagmat_ga8bb70dfa94511eb84368ef6107dd030e}{diagmat}}(eigval) * eigvec.t();}
\DoxyCodeLine{208     }
\DoxyCodeLine{209     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{210     \}}
\DoxyCodeLine{211 \textcolor{preprocessor}{  \#else}}
\DoxyCodeLine{212     \{}
\DoxyCodeLine{213     arma\_ignore(out);}
\DoxyCodeLine{214     arma\_ignore(expr);}
\DoxyCodeLine{215     arma\_stop\_logic\_error(\textcolor{stringliteral}{"{}expmat\_sym(): use of LAPACK must be enabled"{}});}
\DoxyCodeLine{216     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{217     \}}
\DoxyCodeLine{218 \textcolor{preprocessor}{  \#endif}}
\DoxyCodeLine{219   \}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221 }
\DoxyCodeLine{222 }

\end{DoxyCode}
